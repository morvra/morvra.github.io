<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <link href='./WB_icon.png' rel='icon' type='image/x-icon'/>
  <link href='./WB_icon.png' rel='shortcut icon'/>
  <link href='./WB_icon.png' rel='apple-touch-icon'/>
  <title>WBãƒ­ã‚°ãƒãƒ¼ãƒˆ | ã‚·ãƒ£ãƒ‰ã‚¦ãƒãƒ¼ã‚¹WB å¯¾æˆ¦æ”¯æ´</title>
  <style>
    /* åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« */
    body {
      font-family: sans-serif;
      background: #f7f9fb;
      color: #333;
      margin: 0;
      padding: 0;
    }
    main {
      padding: 8px;
      max-width: 1200px;
      margin: auto;
    }
    h2, h3 {
      color: #2c3e50;
      margin-top: 0;
    }

    /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .two-column-layout {
      display: flex;
      flex-wrap: wrap;
      gap: 24px;
      justify-content: center;
    }

    .flex-column-item {
      width: 100%;
      box-sizing: border-box;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }

    /* PCãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (min-width: 984px) {
      .flex-column-item {
        width: auto;
        margin: 0;
        flex-basis: 0;
        min-width: 370px;
      }

      .counter-storage-column {
        flex-grow: 2;
        max-width: 336px;
      }

      .record-panel-column {
        flex-grow: 5;
        max-width: 840px;
      }

      .panel {
        height: fit-content;
      }
      .record-panel {
          display: flex;
          flex-direction: column;
          flex-grow: 1;
          height: auto;
          box-sizing: border-box;
      }
    }

    .panel {
      background: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.04);
      margin-bottom: 16px;
      width: 100%;
      box-sizing: border-box;
    }

    .record-panel h3,
    .record-panel .app-form,
    .record-panel .filter-controls {
        flex-shrink: 0;
    }

    /* ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚°ãƒ«ãƒ¼ãƒ— */
    .counter-control-group {
      align-items: center;
      margin-bottom: 12px;
    }
    .counter-control-group span.label {
      width: 200px;
      font-weight: 600;
      font-size: 15px;
    }
    .counter-control-group button {
      background: #ecf0f1;
      border: none;
      padding: 6px 12px;
      font-size: 18px;
      margin: 0 6px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .counter-control-group button:hover { background: #d0d7de; }
    .count-value {
      font-size: 18px;
      width: 40px;
      text-align: center;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ è¦ç´  */
    .app-form input, .app-form select, .app-form textarea {
      width: 100%;
      max-width: 400px;
      padding: 8px;
      margin-top: 6px;
      margin-bottom: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
      font-size: 14px;
    }
    .app-form label {
      display: block;
      font-weight: 500;
      margin-bottom: 4px;
    }
    .app-form textarea { resize: vertical; }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */
    .form-action-button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      transition: background 0.2s;
      color: white;
    }
    .form-action-button.primary { background: #1abc9c; }
    .form-action-button.primary:hover { background: #16a085; }
    .form-action-button.secondary { background: #F39C12; color: white; }
    .form-action-button.secondary:hover { background: #d35400; }
    .form-action-button.neutral { background: #7f8c8d; }
    .form-action-button.neutral:hover { background: #5d6d7e; }
    .form-action-button.danger { background: #e74c3c; color: white; }
    .form-action-button.danger:hover { background: #c0392b; }

    /* ãƒˆã‚°ãƒ«ãƒœã‚¿ãƒ³ */
    .toggle-button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .toggle-button-group button {
      background: #ecf0f1;
      border: 1px solid #ccc;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      color: #333;    
      transition: background 0.2s, border-color 0.2s;
    }
    .toggle-button-group button.active {
      background: #1abc9c;
      color: white;
      border-color: #16a085;
    }

    /* ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« */
    .data-table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      overflow: hidden;
      font-size: 14px;
      table-layout: fixed; /* ãƒ†ãƒ¼ãƒ–ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å›ºå®š */
    }
    .data-table thead {
      background: #ecf0f1;
      font-weight: bold;
    }
    .data-table th, .data-table td {
      text-align: center;
      padding: 10px;
      border-bottom: 1px solid #eee;
      overflow: hidden; /* ã‚»ãƒ«å†…ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã¯ã¿å‡ºã™ã®ã‚’é˜²ã */
      white-space: nowrap; /* ãƒ†ã‚­ã‚¹ãƒˆã®è‡ªå‹•æ”¹è¡Œã‚’ç„¡åŠ¹åŒ– */
    }
    .data-table tr:hover { background: #f9f9f9; }
    .data-table td:last-child button {
      background: #e74c3c;
      color: white;
      border: none;
      padding: 4px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    .data-table td:last-child button:hover { background: #c0392b; }

    /* PPã€ã‚«ãƒ¼ãƒ‰åã€ãƒ¡ãƒ¢ã®å…¥åŠ›è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .data-table td input[type="text"],
    .data-table td input[type="number"],
    .data-table td textarea {
        width: 100%; /* è¦ªè¦ç´ ã®å¹…ã«ãƒ•ã‚£ãƒƒãƒˆ */
        box-sizing: border-box; /* paddingã¨borderã‚’widthã«å«ã‚ã‚‹ */
        border: 1px solid #ccc;
        padding: 4px;
        font-size: 14px;
        line-height: 1.2; /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®è¡Œã®é«˜ã•ã‚’èª¿æ•´ */
        display: block; /* ãƒ–ãƒ­ãƒƒã‚¯è¦ç´ ã¨ã—ã¦æŒ¯ã‚‹èˆã† */
        min-width: 0; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æœ€å°å¹…ã‚’ä¸Šæ›¸ã */
    }
    .data-table td textarea {
        min-height: 40px; /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã®æœ€å°é«˜ã•ã‚’è¨­å®š */
        resize: vertical; /* ç¸¦æ–¹å‘ã®ã¿ãƒªã‚µã‚¤ã‚ºå¯èƒ½ */
        overflow: hidden; /* ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢è‡ªä½“ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ã‚’éè¡¨ç¤º */
    }


    /* æˆ¦ç¸¾ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¡ãƒ¢æ¬„ */
    #match-record-table th:nth-child(6),
    #match-record-table td:nth-child(6) {
      word-break: break-word; /* å˜èªã®é€”ä¸­ã§æ”¹è¡Œã‚’è¨±å¯ */
      white-space: normal; /* æŠ˜ã‚Šè¿”ã—ã‚’è¨±å¯ */
    }
    /* ãƒ†ã‚­ã‚¹ãƒˆå·¦å¯„ã› */
    #match-record-table td:nth-child(6),
    #card-data-table td:nth-child(2) {
      text-align: left;
      word-break: break-word; /* å˜èªã®é€”ä¸­ã§æ”¹è¡Œã‚’è¨±å¯ */
      white-space: normal; /* æŠ˜ã‚Šè¿”ã—ã‚’è¨±å¯ */
    }

    /* å„ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ—å¹…ã‚’å®šç¾© */

    /* ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ—å¹… */
    #card-data-table th:nth-child(1),
    #card-data-table td:nth-child(1) { width: 30px; } /* PP */
    #card-data-table th:nth-child(2),
    #card-data-table td:nth-child(2) { width: auto; } /* ã‚«ãƒ¼ãƒ‰å&ãƒ¡ãƒ¢ */
    #card-data-table th:nth-child(3),
    #card-data-table td:nth-child(3) { width: 100px; } /* ã‚«ã‚¦ãƒ³ãƒˆ */
    #card-data-table th:nth-child(4),
    #card-data-table td:nth-child(4) { width: 50px; } /* å‰Šé™¤ */

    /* æˆ¦ç¸¾è¨˜éŒ²ãƒ†ãƒ¼ãƒ–ãƒ«ã®åˆ—å¹… */
    #match-record-table th:nth-child(1),
    #match-record-table td:nth-child(1) { width: 120px; } /* æ—¥æ™‚ */
    #match-record-table th:nth-child(2),
    #match-record-table td:nth-child(2) { width: 15%; } /* ãƒ‡ãƒƒã‚­ */
    #match-record-table th:nth-child(3),
    #match-record-table td:nth-child(3) { width: 10%; } /* ç›¸æ‰‹ */
    #match-record-table th:nth-child(4),
    #match-record-table td:nth-child(4) { width: 70px; } /* å…ˆå¾Œ */
    #match-record-table th:nth-child(5),
    #match-record-table td:nth-child(5) { width: 70px; } /* å‹æ•— */
    #match-record-table th:nth-child(6),
    #match-record-table td:nth-child(6) { width: auto; } /* ãƒ¡ãƒ¢ */
    #match-record-table th:nth-child(7),
    #match-record-table td:nth-child(7) { width: 50px; } /* å‰Šé™¤ */


    /* ã‚«ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ */
    .card-actions {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      margin-bottom: 12px;
    }
    .card-actions .form-action-button {
      padding: 6px 12px;
      font-size: 14px;
    }

    /* ã‚«ãƒ¼ãƒ‰å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ */
    .card-delete-button { display: none; }
    .delete-mode .card-delete-button { display: inline-block; }
    #card-data-table th:nth-child(4),
    #card-data-table td:nth-child(4) { display: none; }
    #counter-section.delete-mode #card-data-table th:nth-child(4),
    #counter-section.delete-mode #card-data-table td:nth-child(4) { display: table-cell; }

    /* ãƒ‡ãƒ¼ã‚¿ç®¡ç†ãƒ‘ãƒãƒ« */
    .data-management-panel > h3 {
      color: #2c3e50;
      margin-top: 0;
      margin-bottom: 12px;
    }
    .data-management-panel .toggle-button-group { margin-bottom: 12px; }
    .data-management-panel .form-action-button {
      min-width: 96px;
      text-align: center;
    }
    .file-input-label { cursor: pointer; }
    .file-input-button {
      display: inline-block;
      background: #ecf0f1;
      border: 1px solid #ccc;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 14px;
      color: #333;
      user-select: none;
      min-width: 70px;
      text-align: center;
      transition: background 0.2s, border-color 0.2s;
    }
    .file-input-button:hover { background: #d0d7de; }
    .data-management-panel input[type="file"] { display: none; }
		
		/* Adsense */
    #ad {
		   text-align: center;
		   color: #aaa;
	     font-size: 90%;
			 max-width: 336px;
			 margin: 40px auto 24px;
		}

    /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .tab-navigation {
      display: flex;
      margin-bottom: 20px;
      background: #e9ecef;
    }
    .tab-navigation-button {
      flex: 1;
      padding: 10px 5px;
      font-size: 15px;
      text-align: center;
      cursor: pointer;
      background: transparent;
      border: none;
      transition: background 0.3s, color 0.3s;
      font-weight: 600;
      color: #495057;
      -webkit-tap-highlight-color: transparent;
    }
    .tab-navigation-button:hover { background: #dee2e6; }
    .tab-navigation-button.active {
      background: #fff;
      color: #1abc9c;
    }

    /* ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ©ãƒ  */
    .form-columns {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .form-left, .form-right {
      flex: 1;
      min-width: 250px;
    }

    /* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
    .filter-controls {
      margin-top: 20px;
      margin-bottom: 20px;
      padding: 0;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background-color: #fcfcfc;
      overflow: hidden;
    }
    .filter-controls details { border: none; }
    .filter-controls summary {
      padding: 16px;
      cursor: pointer;
      outline: none;
      font-weight: bold;
      color: #2c3e50;
      position: relative;
      list-style: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .filter-controls summary::marker,
    .filter-controls summary::-webkit-details-marker { display: none; }
    .filter-controls summary .filter-summary-title { margin: 0; font-size:18px; }
    .filter-controls summary .toggle-icon {
      display: inline-block;
      width: 20px;
      height: 20px;
      background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-down"><polyline points="6 9 12 15 18 9"></polyline></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transition: transform 0.2s ease-in-out;
    }
    .filter-controls details[open] summary .toggle-icon { transform: rotate(180deg); }
	input#filter-deck-name-input {
      margin-top: 4px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
    }

    .filter-content-wrapper {
      padding: 0 16px 16px 16px;
      overflow: hidden;
      max-height: 0;
      transition: max-height 0.3s ease-out;
    }
    .filter-controls details[open] .filter-content-wrapper { max-height: 500px; }

    .filter-content-wrapper .app-form input[type="text"] { margin-bottom: 16px; }
    .filter-content-wrapper .form-action-button { margin-top: 15px; }

    /* ã‚«ãƒ¼ãƒ‰è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    .add-card-form-layout {
      margin-top:12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    .add-card-form-layout input[type="number"] {
      width: 60px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size:14px;
    }
    .add-card-form-layout input[type="text"] {
      flex: 1;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size:14px;
    }
    .add-card-form-layout .form-action-button {
      padding: 4px 16px;
      margin-top: -10px;
      font-size: 14px;
    }

    /* ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒœã‚¿ãƒ³ (PCç”¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) */
    #card-data-table td button {
        width: 24px;
        height: 24px;
        padding: 0;
        font-size: 18px;
	    color: #333;
        border-radius: 4px;
        border: 1px solid #ccc;
        background: #ecf0f1;
        transition: background 0.2s;
    }
    #card-data-table td button:hover { background: #d0d7de; }
    #card-data-table td button:first-child { margin-right: 6px; }
    #card-data-table td button:last-child { margin-left: 6px; }

    /* ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ã®ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤º (PCç”¨ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) */
    #card-data-table td span {
      display: inline-block;
      width: 24px;
      text-align: center;
    }

    .data-table th, .data-table td {
        padding: 6px;
        border-bottom: 1px solid #ddd;
    }
    .data-table thead tr { background:#ecf0f1; }
    .info-display {
      font-weight: bold;
      margin-bottom: 8px;
      min-height: 24px;
    }

    /* ãƒ¢ãƒã‚¤ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
    @media (max-width: 983px) {
      .tab-navigation {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        margin-bottom: 0;
        border-radius: 0;
        z-index: 1000;
        padding-bottom: env(safe-area-inset-bottom, 4px);
      }

      body {
        padding-bottom: calc(56px + env(safe-area-inset-bottom, 0px));
      }

      #match-record-table-wrapper { display: none; } /* ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ãƒ†ãƒ¼ãƒ–ãƒ«éè¡¨ç¤º */
      #match-record-cards-container {
          display: flex;
          flex-direction: column;
          gap: 16px;
          margin-top: 16px;
      }

      .match-record-card {
          background: white;
          border-radius: 8px;
          padding: 12px;
          border: 1px solid #e0e0e0;
          display: flex;
          flex-direction: column;
          gap: 6px;
          position: relative;
          font-size: 14px;
      }

      .match-record-card .card-item {
          display: flex;
          align-items: flex-start;
      }

      .match-record-card .card-label {
          font-weight: bold;
          min-width: 50px;
          margin-right: 6px;
          color: #444;
      }

      .match-record-card .card-value {
          flex-grow: 1;
          word-break: break-word;
          font-size: 14px;
          white-space: normal; /* ãƒ¢ãƒã‚¤ãƒ«ã®ãƒ¡ãƒ¢ã‚‚æŠ˜ã‚Šè¿”ã—ã‚’è¨±å¯ */
      }

      .match-record-card .delete-card-button {
          position: absolute;
          top: 6px;
          right: 6px;
          background: transparent;
          border: none;
          font-size: 16px;
          cursor: pointer;
          color: #e74c3c;
          padding: 4px;
          border-radius: 4px;
      }
      .match-record-card .delete-card-button:hover {
          color: #c0392b;
          background-color: #fce7e7;
      }
      
      /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ«ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’èª¿æ•´ */
      .data-table th, .data-table td {
        padding: 8px 6px; /* ç¸¦æ–¹å‘ã¯8pxã€æ¨ªæ–¹å‘ã¯6pxã«èª¿æ•´ */
      }

      /* ã‚«ã‚¦ãƒ³ãƒˆåˆ—ã®tdã«flexboxã‚’é©ç”¨ */
      #card-data-table td:nth-child(3) { /* ã‚«ã‚¦ãƒ³ãƒˆåˆ—ã®td */
          display: flex;
          align-items: center;
          justify-content: center;
          padding-left: 0; /* ãƒœã‚¿ãƒ³ã¨spanãŒç‹¬è‡ªã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’æŒã¤ãŸã‚ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å‰Šé™¤ */
          padding-right: 0;
      }

      /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒœã‚¿ãƒ³ã®èª¿æ•´ */
      #card-data-table td button {
          width: 40px; /* ã‚¿ãƒƒãƒã—ã‚„ã™ã„ã‚µã‚¤ã‚ºã‚’ç¶­æŒã—ã¤ã¤ã€å°‘ã—å°ã•ã */
          height: 40px;
          font-size: 22px; /* ã‚¢ã‚¤ã‚³ãƒ³ã‚’å°‘ã—å°ã•ã */
          padding: 0; /* ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã§ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã‚’åˆ¶å¾¡ */
          box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’ã‚µã‚¤ã‚ºã«å«ã‚ã‚‹ */
          vertical-align: middle; /* spanã¨ä½ç½®ã‚’åˆã‚ã›ã‚‹ */
      }
      #card-data-table td button:first-child { margin-right: 4px; } /* ãƒãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ */
      #card-data-table td button:last-child { margin-left: 4px; }

      /* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ã‚«ã‚¦ãƒ³ãƒˆæ•°å­—ã®è¡¨ç¤ºèª¿æ•´ */
      #card-data-table td span {
          font-size: 18px; /* ã‚«ã‚¦ãƒ³ãƒˆã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’èª¿æ•´ */
          padding: 0 2px; /* å·¦å³ã®ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã§å°‘ã—ã‚¹ãƒšãƒ¼ã‚¹ã‚’ç¢ºä¿ */
          vertical-align: middle; /* ãƒœã‚¿ãƒ³ã¨ä½ç½®ã‚’åˆã‚ã›ã‚‹ */
      }
    }

    /* PCãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆå†å®šç¾©ï¼‰ */
    @media (min-width: 984px) {
      .tab-navigation {
        position: static;
        margin-bottom: 20px;
        border-top: none;
      }
      body { padding-bottom: 0; }

      #match-record-table-wrapper {
          display: block;
          height: auto;
          flex-grow: 1;
          overflow-y: auto;
          max-height: 86vh;
      }
      #match-record-cards-container { display: none; }
      #load-more-records-button { display: none; }
    }

    /* ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã¨ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— */
    .info-container {
      display: none; /* é€šå¸¸ã¯éè¡¨ç¤º */
      position: fixed;
      right: 24px;
      bottom: 24px;
      z-index: 1010;
    }
    
    /* bodyã«ç‰¹å®šã®ã‚¯ãƒ©ã‚¹ãŒã‚ã‚‹æ™‚ã ã‘è¡¨ç¤º */
    body.active-tab-storage-section .info-container {
      display: block;
    }

    .info-button {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background-color: #7f8c8d;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      font-weight: bold;
      cursor: help;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: background-color 0.2s;
      user-select: none;
    }

    .info-button:hover {
      background-color: #5d6d7e;
    }

    .info-tooltip {
      visibility: hidden;
      opacity: 0;
      position: absolute;
      bottom: 120%;
      right: 0;
      width: max-content;
      max-width: 320px;
      background-color: #2c3e50;
      color: #fff;
      text-align: left;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      line-height: 1.6;
      box-shadow: 0 4px 12px rgba(0,0,0,0.25);
      transition: opacity 0.3s ease, visibility 0.3s ease;
      pointer-events: none;
    }

    .info-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      right: 15px;
      border-width: 6px;
      border-style: solid;
      border-color: #2c3e50 transparent transparent transparent;
    }

    /* æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«: JavaScriptã§è¿½åŠ ã•ã‚Œã‚‹ã‚¯ãƒ©ã‚¹ */
    .info-tooltip.show {
        visibility: visible;
        opacity: 1;
    }

    @media (max-width: 983px) {
      .info-container {
        bottom: calc(56px + env(safe-area-inset-bottom, 0px) + 20px);
        right: 20px;
      }
      .info-button {
        width: 40px;
        height: 40px;
        font-size: 20px;
      }
      .info-tooltip {
         font-size: 13px;
      }
    }

    /* è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ«: çµ±è¨ˆæƒ…å ±è¡¨ç¤ºç”¨ */
    .record-summary {
        display: flex;
        flex-direction: column; /* Changed to column for stats inside details */
        gap: 10px; /* Adjust spacing between elements */
        margin-top: 10px; /* Added margin to separate from filter controls */
    }

    .record-stats {
        display: flex;
        gap: 15px; /* Spacing between individual stats */
        flex-wrap: wrap;
        padding: 0; /* Remove padding as it's now inside the content wrapper */
    }

    .stat-item {
        white-space: nowrap; /* Prevent breaking lines within a stat item */
    }

    .stat-label {
        font-weight: normal; /* Less bold than the value */
        color: #555;
    }

    .stat-value {
        font-weight: bold;
        color: #2c3e50;
    }
  </style>
</head>

<body>
  <main>
    <div class="tab-navigation">
      <button class="tab-navigation-button active" data-tab="counter-section" aria-controls="counter-section" aria-selected="true">ãƒ—ãƒ¬ã‚¤ä¸­</button>
      <button class="tab-navigation-button" data-tab="record-section" aria-controls="record-section" aria-selected="false">å¯¾æˆ¦è¨˜éŒ²</button>
      <button class="tab-navigation-button" data-tab="storage-section" aria-controls="storage-section" aria-selected="false">ãƒ‡ãƒ¼ã‚¿ç®¡ç†</button>
    </div>

    <div class="two-column-layout">
      <section class="panel flex-column-item counter-storage-column tab-content" id="counter-section">
          <div class="card-list-container">
              <h3>è­¦æˆ’ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ</h3>
              <div class="toggle-button-group class-filter-group" id="class-filter-group">
                <button type="button" data-class="ã‚¨ãƒ«ãƒ•">ã‚¨ãƒ«ãƒ•</button>
                <button type="button" data-class="ãƒ­ã‚¤ãƒ¤ãƒ«">ãƒ­ã‚¤ãƒ¤ãƒ«</button>
                <button type="button" data-class="ã‚¦ã‚£ãƒƒãƒ">ã‚¦ã‚£ãƒƒãƒ</button>
                <button type="button" data-class="ãƒ‰ãƒ©ã‚´ãƒ³">ãƒ‰ãƒ©ã‚´ãƒ³</button>
                <button type="button" data-class="ãƒŠã‚¤ãƒˆãƒ¡ã‚¢">ãƒŠã‚¤ãƒˆãƒ¡ã‚¢</button>
                <button type="button" data-class="ãƒ“ã‚·ãƒ§ãƒƒãƒ—">ãƒ“ã‚·ãƒ§ãƒƒãƒ—</button>
                <button type="button" data-class="ãƒãƒ¡ã‚·ã‚¹">ãƒãƒ¡ã‚·ã‚¹</button>
              </div>
              <div class="card-actions">
                <button type="button" id="reset-card-counts-button" class="form-action-button secondary">ã‚«ã‚¦ãƒ³ãƒˆã‚’ã‚¯ãƒªã‚¢</button>
                <button type="button" id="toggle-card-delete-mode-button" class="form-action-button neutral">å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ OFF</button>
              </div>
              <div id="current-class-display" class="info-display"></div>
              <table id="card-data-table" class="data-table">
                <thead>
                  <tr>
                    <th>PP</th>
                    <th>ã‚«ãƒ¼ãƒ‰å&ãƒ¡ãƒ¢</th>
                    <th>ã‚«ã‚¦ãƒ³ãƒˆ</th>
                    <th>å‰Šé™¤</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
              <form id="add-card-form" class="app-form add-card-form-layout">
                <input type="number" id="new-card-pp-input" placeholder="PP" min="0" required>
                <input type="text" id="new-card-name-input" placeholder="ã‚«ãƒ¼ãƒ‰å" required>
                <button type="submit" class="form-action-button primary">è¿½åŠ </button>
              </form>
          </div>
      </section>

      <section class="panel flex-column-item counter-storage-column tab-content" id="storage-section" style="display: none;">
          <div class="data-management-panel">
              <h3>ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h3>
              <div class="toggle-button-group">
                <button type="button" id="export-records-button" class="form-action-button secondary">æˆ¦ç¸¾</button>
                <button type="button" id="export-cards-button" class="form-action-button secondary">ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ</button>
                <button type="button" id="export-all-data-button" class="form-action-button secondary">å…¨ä½“</button>
              </div>
              <h3>ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h3>
              <div class="toggle-button-group" style="margin-top: 10px;">
              <label class="file-input-label">
                  <span class="file-input-button">æˆ¦ç¸¾</span>
                  <input type="file" id="import-records-file-input" accept=".json">
                </label>
                <label class="file-input-label">
                  <span class="file-input-button">ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ</span>
                  <input type="file" id="import-cards-file-input" accept=".json">
                </label>
                <label class="file-input-label">
                  <span class="file-input-button">å…¨ä½“</span>
                  <input type="file" id="import-all-data-file-input" accept=".json">
                </label>
              </div>
				<h3>æˆ¦ç¸¾ã®å‰Šé™¤</h3>
					<div class="toggle-button-group">
					  <button type="button" id="clear-records-button" class="form-action-button danger">
					    å…¨å‰Šé™¤
					  </button>
					</div>
          </div>
				<div id="ad">
					ã‚¹ãƒãƒ³ã‚µãƒ¼ãƒ‰ãƒªãƒ³ã‚¯
					<ins class="adsbygoogle"
							 style="display:block"
							 data-ad-client="ca-pub-3575252598876356"
							 data-ad-slot="6223968026"
							 data-ad-format="rectangle"></ins>
        </div>
      </section>

      <section class="panel record-panel tab-content flex-column-item record-panel-column" id="record-section" style="display: none;">
        <h3 style="flex-shrink: 0;">å¯¾æˆ¦è¨˜éŒ²</h3>
        <form id="add-record-form" class="app-form" style="flex-shrink: 0;">
          <div class="form-columns">
            <div class="form-left">
              <label for="my-deck-input">è‡ªåˆ†ã®ãƒ‡ãƒƒã‚­</label>
              <input type="text" id="my-deck-input" name="deck" required>
              <label>ç›¸æ‰‹ã®ã‚¯ãƒ©ã‚¹</label>
              <div class="toggle-button-group" id="opponent-class-selection">
                <button type="button" data-value="ã‚¨ãƒ«ãƒ•">ã‚¨ãƒ«ãƒ•</button>
                <button type="button" data-value="ãƒ­ã‚¤ãƒ¤ãƒ«">ãƒ­ã‚¤ãƒ¤ãƒ«</button>
                <button type="button" data-value="ã‚¦ã‚£ãƒƒãƒ">ã‚¦ã‚£ãƒƒãƒ</button>
                <button type="button" data-value="ãƒ‰ãƒ©ã‚´ãƒ³">ãƒ‰ãƒ©ã‚´ãƒ³</button>
                <button type="button" data-value="ãƒŠã‚¤ãƒˆãƒ¡ã‚¢">ãƒŠã‚¤ãƒˆãƒ¡ã‚¢</button>
                <button type="button" data-value="ãƒ“ã‚·ãƒ§ãƒƒãƒ—">ãƒ“ã‚·ãƒ§ãƒƒãƒ—</button>
                <button type="button" data-value="ãƒãƒ¡ã‚·ã‚¹">ãƒãƒ¡ã‚·ã‚¹</button>
              </div>
            </div>
            <div class="form-right">
              <label>å…ˆå¾Œ</label>
              <div class="toggle-button-group" id="turn-order-selection">
                <button type="button" data-value="å…ˆæ”»">å…ˆæ”»</button>
                <button type="button" data-value="å¾Œæ”»">å¾Œæ”»</button>
              </div>
              <label>å‹æ•—</label>
              <div class="toggle-button-group" id="match-result-selection">
                <button type="button" data-value="â­•">å‹ã¡</button>
                <button type="button" data-value="âœ–">è² ã‘</button>
              </div>
              <label for="record-memo-input">ãƒ¡ãƒ¢</label>
              <textarea id="record-memo-input" name="memo" rows="2"></textarea>
            </div>
          </div>
          <button type="submit" class="form-action-button primary">è¨˜éŒ²ã™ã‚‹</button>
        </form>

        <div class="filter-controls" style="flex-shrink: 0;">
            <details id="record-filter-details">
                <summary>
                    <span class="filter-summary-title">æˆ¦ç¸¾ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ <span class="toggle-icon"></span></span>
                </summary>
                <div class="filter-content-wrapper">
                    <div class="form-columns">
                        <div class="form-left">
                            <label for="filter-deck-name-input">è‡ªåˆ†ã®ãƒ‡ãƒƒã‚­åã§çµã‚Šè¾¼ã¿</label>
                            <input type="text" id="filter-deck-name-input" placeholder="ãƒ‡ãƒƒã‚­åã‚’å…¥åŠ›">
                            <!-- New filter for turn order -->
                            <div style="display: box; margin-top: 8px;"><label style="margin-top: 15px;">å…ˆå¾Œã§çµã‚Šè¾¼ã¿</label></div>
                            <div class="toggle-button-group" id="filter-turn-order-selection">
                              <button type="button" data-value="">ã™ã¹ã¦</button>
                              <button type="button" data-value="å…ˆæ”»">å…ˆæ”»</button>
                              <button type="button" data-value="å¾Œæ”»">å¾Œæ”»</button>
                            </div>
                        </div>
                        <div class="form-right">
                            <label>ç›¸æ‰‹ã®ã‚¯ãƒ©ã‚¹ã§çµã‚Šè¾¼ã¿</label>
                            <div class="toggle-button-group" id="filter-opponent-class-selection">
                              <button type="button" data-value="">ã™ã¹ã¦</button>
                              <button type="button" data-value="ã‚¨ãƒ«ãƒ•">ã‚¨ãƒ«ãƒ•</button>
                              <button type="button" data-value="ãƒ­ã‚¤ãƒ¤ãƒ«">ãƒ­ã‚¤ãƒ¤ãƒ«</button>
                              <button type="button" data-value="ã‚¦ã‚£ãƒƒãƒ">ã‚¦ã‚£ãƒƒãƒ</button>
                              <button type="button" data-value="ãƒ‰ãƒ©ã‚´ãƒ³">ãƒ‰ãƒ©ã‚´ãƒ³</button>
                              <button type="button" data-value="ãƒŠã‚¤ãƒˆãƒ¡ã‚¢">ãƒŠã‚¤ãƒˆãƒ¡ã‚¢</button>
                              <button type="button" data-value="ãƒ“ã‚·ãƒ§ãƒƒãƒ—">ãƒ“ã‚·ãƒ§ãƒƒãƒ—</button>
                              <button type="button" data-value="ãƒãƒ¡ã‚·ã‚¹">ãƒãƒ¡ã‚·ã‚¹</button>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="clear-record-filters-button" class="form-action-button primary">ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¯ãƒªã‚¢</button>

                    <div class="record-summary">
                        <div class="record-stats">
                            <span class="stat-item"><span class="stat-label">è©¦åˆæ•°: </span><span id="total-matches-display" class="stat-value">0</span></span>
                            <span class="stat-item"><span class="stat-label">å‹åˆ©æ•°: </span><span id="total-wins-display" class="stat-value">0</span></span>
                            <span class="stat-item"><span class="stat-label">å‹ç‡: </span><span id="win-rate-display" class="stat-value">0.00%</span></span>
                        </div>
                    </div>
                </div>
            </details>
        </div>

		<h3 style="margin-bottom:8px;">è¨˜éŒ²ä¸€è¦§</h3>
		<div class="record-table-wrapper" id="match-record-table-wrapper">
        <table id="match-record-table" class="data-table">
          <thead>
            <tr>
              <th>æ—¥æ™‚</th>
              <th>ãƒ‡ãƒƒã‚­</th>
              <th>ç›¸æ‰‹</th>
              <th>å…ˆå¾Œ</th>
              <th>å‹æ•—</th>
              <th>ãƒ¡ãƒ¢</th>
              <th>å‰Šé™¤</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
		</div>
        <div id="match-record-cards-container">
            </div>
        <button id="load-more-records-button" class="form-action-button neutral" style="display: none; width: 100%; margin-top: 20px;">ã•ã‚‰ã«è¡¨ç¤º</button>
      </section>
	</div>
  </main>

  <div class="info-container">
    <div class="info-button" id="info-button-trigger">i</div>
    <div class="info-tooltip" id="info-tooltip-content">
      ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ morvra ã«ã‚ˆã£ã¦å€‹äººã§åˆ¶ä½œã•ã‚ŒãŸã€<br>
      Shadowverse: Worlds Beyond ã®éå…¬å¼ãƒ•ã‚¡ãƒ³ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>
      Cygames ã¨ã¯ä¸€åˆ‡é–¢ä¿‚ã‚ã‚Šã¾ã›ã‚“ã€‚
    </div>
  </div>

  <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«UI -->
  <div id="custom-modal-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 2000; display: flex; justify-content: center; align-items: center;">
    <div id="custom-modal-content" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); max-width: 90%; width: 350px; text-align: center;">
      <p id="modal-message" style="margin-bottom: 20px; font-size: 16px;"></p>
      <div id="modal-buttons">
        <button id="modal-ok-button" class="form-action-button primary" style="margin: 0 5px;">OK</button>
        <button id="modal-cancel-button" class="form-action-button neutral" style="margin: 0 5px; display: none;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    // Local Storage Utility
    const Storage = {
      get: (key, defaultValue = null) => {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : defaultValue;
        } catch (e) {
          console.error(`Failed to get item from localStorage for key "${key}":`, e);
          return defaultValue;
        }
      },
      set: (key, value) => {
        try {
          localStorage.setItem(key, JSON.stringify(value));
        } catch (e) {
          console.error(`Failed to set item to localStorage for key "${key}":`, e);
        }
      },
      remove: (key) => {
        try {
          localStorage.removeItem(key);
        } catch (e) {
          console.error(`Failed to remove item from localStorage for key "${key}":`, e);
        }
      },
      getAllKeys: (prefix) => {
        const keys = [];
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key.startsWith(prefix)) {
            keys.push(key);
          }
        }
        return keys;
      }
    };

    // Debounce Utility
    const debounce = (func, delay) => {
      let timeout;
      return function(...args) {
        const context = this;
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(context, args), delay);
      };
    };

    // Local Storage Keys
    const LAST_TAB_KEY = 'svwb-last-tab';
    const RECORDS_KEY = 'svwb-records';
    const LAST_DECK_KEY = 'svwb-deck';
    const FILTER_DECK_KEY = 'svwb-filter-deck';
    const FILTER_CLASS_KEY = 'svwb-filter-class';
    const FILTER_TURN_KEY = 'svwb-filter-turn';
    const FILTER_OPEN_KEY = 'svwb-filter-open-state';
    const CARD_CLASS_PREFIX = 'svwb-cards-';

    // Custom Modal Module
    const ModalManager = (() => {
        let overlay;
        let messageElement;
        let okButton;
        let cancelButton;
        let resolvePromise = () => {};

        const init = () => {
            overlay = document.getElementById('custom-modal-overlay');
            messageElement = document.getElementById('modal-message');
            okButton = document.getElementById('modal-ok-button');
            cancelButton = document.getElementById('modal-cancel-button');

            // åˆæœŸåŒ–æ™‚ã«ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’å¼·åˆ¶çš„ã«éè¡¨ç¤ºã«ã™ã‚‹
            overlay.style.display = 'none';

            okButton.addEventListener('click', () => {
                overlay.style.display = 'none';
                resolvePromise(true);
                resolvePromise = () => {}; // Promiseè§£æ±ºå¾Œã«ãƒªã‚»ãƒƒãƒˆ
            });

            cancelButton.addEventListener('click', () => {
                overlay.style.display = 'none';
                resolvePromise(false);
                resolvePromise = () => {}; // Promiseè§£æ±ºå¾Œã«ãƒªã‚»ãƒƒãƒˆ
            });
        };

        const showAlert = (message) => {
            return new Promise(resolve => {
                messageElement.textContent = message;
                okButton.style.display = 'inline-block';
                cancelButton.style.display = 'none';
                overlay.style.display = 'flex';
                resolvePromise = resolve;
            });
        };

        const showConfirm = (message) => {
            return new Promise(resolve => {
                messageElement.textContent = message;
                okButton.style.display = 'inline-block';
                cancelButton.style.display = 'inline-block';
                overlay.style.display = 'flex';
                resolvePromise = resolve;
            });
        };

        return { init, showAlert, showConfirm };
    })();

    // Tab Management Module
    const TabManager = (() => {
      const tabs = document.querySelectorAll('.tab-navigation-button');
      const panes = document.querySelectorAll('.tab-content');

      const showTab = (targetPaneId) => {
        document.body.className = document.body.className.replace(/\bactive-tab-[\w-]+\b/g, '');
        document.body.classList.add('active-tab-' + targetPaneId);

        Storage.set(LAST_TAB_KEY, targetPaneId);
        const isLargeScreen = window.matchMedia('(min-width: 984px)').matches;

        panes.forEach(pane => pane.style.display = 'none');
        tabs.forEach(t => {
            t.classList.remove('active');
            t.setAttribute('aria-selected', 'false');
        });

        if (isLargeScreen && (targetPaneId === 'counter-section' || targetPaneId === 'record-section')) {
          const counterPane = document.getElementById('counter-section');
          const recordPane = document.getElementById('record-section');
          const counterTabButton = document.querySelector(`.tab-navigation-button[data-tab="counter-section"]`);
          const recordTabButton = document.querySelector(`.tab-navigation-button[data-tab="record-section"]`);

          if (counterPane) counterPane.style.display = 'block';
          if (recordPane) {
            recordPane.style.display = 'flex';
            recordPane.style.flexDirection = 'column';
          }

          if (counterTabButton) {
              counterTabButton.classList.add('active');
              counterTabButton.setAttribute('aria-selected', 'true');
          }
          if (recordTabButton) {
              recordTabButton.classList.add('active');
              recordTabButton.setAttribute('aria-selected', 'true');
          }
        } else {
          const targetPane = document.getElementById(targetPaneId);
          if (targetPane) {
            if (targetPaneId === 'record-section') {
              targetPane.style.display = 'flex';
              targetPane.style.flexDirection = 'column';
            } else {
              targetPane.style.display = 'block';
            }
          }
          const targetTab = document.querySelector(`.tab-navigation-button[data-tab="${targetPaneId}"]`);
          if (targetTab) {
            targetTab.classList.add('active');
            targetTab.setAttribute('aria-selected', 'true');
          }
        }

        // AdSense ã®ãƒªãƒ­ãƒ¼ãƒ‰
        if (targetPaneId === 'storage-section') {
            try {
                if (window.adsbygoogle && typeof window.adsbygoogle.push === 'function') {
                    document.querySelectorAll('ins.adsbygoogle').forEach(ad => {
                        (window.adsbygoogle = window.adsbygoogle || []).push({});
                    });
                } else {
                    console.warn('AdSense ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‹ã€push ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚');
                }
            } catch (error) {
                console.error('AdSense ã®ãƒªãƒ­ãƒ¼ãƒ‰ä¸­ã«ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
      };

      const init = () => {
        tabs.forEach(tab => {
          tab.addEventListener('click', () => showTab(tab.dataset.tab));
        });

        const lastTab = Storage.get(LAST_TAB_KEY, 'counter-section');
        showTab(lastTab);

        window.addEventListener('resize', () => {
          const currentActiveTabId = Storage.get(LAST_TAB_KEY, 'counter-section');
          showTab(currentActiveTabId);
          RecordManager.applyFilters();
        });
      };

      return { init };
    })();

    // Toggle Button Group Management Module
    const ToggleButtonGroup = (() => {
      const init = () => {
        document.querySelectorAll('.toggle-button-group').forEach(group => {
          group.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
              group.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
              e.target.classList.add('active');
              if (group.id.startsWith('filter-')) {
                  const event = new CustomEvent('filterChange', { detail: { groupId: group.id, value: e.target.dataset.value } });
                  document.dispatchEvent(event);
              }
            }
          });
        });
      };

      const getSelectedValue = (groupId) => {
        const active = document.querySelector(`#${groupId} .active`);
        return active ? active.dataset.value : '';
      };

      const setActiveButton = (groupId, value) => {
        const group = document.getElementById(groupId);
        if (group) {
          group.querySelectorAll('button').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.value === value) {
              btn.classList.add('active');
            }
          });
        }
      };

      return { init, getSelectedValue, setActiveButton };
    })();

    // Record Management Module
    const RecordManager = (() => {
      const recordsPerPage = 10;
      let currentDisplayCount = recordsPerPage;

      const matchRecordTableBody = document.querySelector('#match-record-table tbody');
      const addRecordForm = document.getElementById('add-record-form');
      const myDeckInput = document.getElementById('my-deck-input');
      const recordMemoInput = document.getElementById('record-memo-input');
      const filterDeckNameInput = document.getElementById('filter-deck-name-input');
      const clearRecordFiltersButton = document.getElementById('clear-record-filters-button');
      const recordFilterDetails = document.getElementById('record-filter-details');
      const matchRecordCardsContainer = document.getElementById('match-record-cards-container');
      const loadMoreButton = document.getElementById('load-more-records-button');

      const totalMatchesDisplay = document.getElementById('total-matches-display');
      const totalWinsDisplay = document.getElementById('total-wins-display');
      const winRateDisplay = document.getElementById('win-rate-display');

      let allRecords = [];
      let filteredRecordsCache = [];

      // ãƒ†ãƒ¼ãƒ–ãƒ«ã‚»ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ãƒ©ãƒ™ãƒ«ã‚’è¿½åŠ  (ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ)
      const addDataLabelsToRecordTable = () => {
        const headers = Array.from(document.querySelectorAll('#match-record-table th')).map(th => th.textContent);
        document.querySelectorAll('#match-record-table tbody tr').forEach(row => {
          Array.from(row.querySelectorAll('td')).forEach((td, index) => {
            if (headers[index] && index < headers.length -1) {
              td.dataset.label = headers[index];
            }
          });
        });
      };

      // ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
      const saveRecords = () => {
        const data = allRecords.map(record => ({
          timestamp: record.timestamp,
          date: record.date,
          deck: record.deck,
          opponent: record.opponent,
          firstSecond: record.firstSecond,
          result: record.result,
          memo: record.memo
        }));
        Storage.set(RECORDS_KEY, data);
      };

      // ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰ã€ã‚½ãƒ¼ãƒˆã€ãƒ•ã‚£ãƒ«ã‚¿é©ç”¨
      const loadRecords = () => {
        allRecords = Storage.get(RECORDS_KEY, []);
        allRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
        currentDisplayCount = recordsPerPage;
        applyFilters();
      };

      // çµ±è¨ˆæƒ…å ±ã‚’æ›´æ–°
      const updateStatistics = (records) => {
          const totalMatches = records.length;
          const totalWins = records.filter(record => record.result === 'â­•').length;
          const winRate = totalMatches > 0 ? ((totalWins / totalMatches) * 100).toFixed(2) : '0.00';

          totalMatchesDisplay.textContent = totalMatches;
          totalWinsDisplay.textContent = totalWins;
          winRateDisplay.textContent = `${winRate}%`;
      };

      // ãƒ•ã‚£ãƒ«ã‚¿ã‚’é©ç”¨ã—ã€ãƒ¬ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºã‚’æ›´æ–°
      const applyFilters = () => {
        matchRecordTableBody.innerHTML = '';
        matchRecordCardsContainer.innerHTML = '';

        const filterDeckName = filterDeckNameInput.value.toLowerCase();
        const filterOpponentClass = ToggleButtonGroup.getSelectedValue('filter-opponent-class-selection');
        const filterTurnOrder = ToggleButtonGroup.getSelectedValue('filter-turn-order-selection');

        const filteredRecords = allRecords.filter(record => {
          const matchesDeck = record.deck.toLowerCase().includes(filterDeckName);
          const matchesClass = filterOpponentClass === '' || record.opponent === filterOpponentClass;
          const matchesTurnOrder = filterTurnOrder === '' || record.firstSecond === filterTurnOrder;
          return matchesDeck && matchesClass && matchesTurnOrder;
        });
        filteredRecordsCache = filteredRecords;

        updateStatistics(filteredRecordsCache);

        const isLargeScreen = window.matchMedia('(min-width: 984px)').matches;

        if (isLargeScreen) {
            filteredRecordsCache.forEach(entry => {
                matchRecordTableBody.appendChild(createRecordHtml(entry));
            });
            addDataLabelsToRecordTable();
            loadMoreButton.style.display = 'none';
        } else {
            const recordsToRender = filteredRecordsCache.slice(0, currentDisplayCount);
            recordsToRender.forEach(entry => {
                matchRecordCardsContainer.appendChild(createRecordHtml(entry));
            });
            loadMoreButton.style.display = (filteredRecordsCache.length > currentDisplayCount) ? 'block' : 'none';
        }
      };

      // ã‚»ãƒ«ã‚’ç·¨é›†å¯èƒ½ã«ã™ã‚‹
      const makeEditableCell = (td, entry, fieldName, type = 'text') => { 
        td.addEventListener('click', () => {
          if (td.querySelector('input') || td.querySelector('textarea')) return;

          const currentValue = entry[fieldName];
          const input = type === 'textarea' ? document.createElement('textarea') : document.createElement('input');
          if (type === 'text') input.type = 'text';
          input.value = currentValue;
          Object.assign(input.style, { fontSize: '14px' });
          input.setAttribute('aria-label', `${fieldName}ã‚’ç·¨é›†`);
          
          td.textContent = '';
          td.appendChild(input);
          input.focus();

          const finalizeEdit = () => {
            const val = input.value.trim();
            if (entry[fieldName] !== val) {
              entry[fieldName] = val;
              saveRecords();
            }
            td.textContent = val;
            if (input.parentNode === td) input.remove();
          };

          input.addEventListener('blur', finalizeEdit);
          input.addEventListener('keydown', (ev) => {
            if (ev.key === 'Enter') {
              if (type === 'textarea') {
                if (!ev.shiftKey) {
                  ev.preventDefault();
                  finalizeEdit();
                }
              } else {
                ev.preventDefault();
                finalizeEdit();
              }
            } else if (ev.key === 'Escape') {
              td.textContent = currentValue;
              if (input.parentNode === td) input.remove();
            }
          });
        });
      };

      // ãƒ¬ã‚³ãƒ¼ãƒ‰ã®HTMLè¦ç´ ã‚’ç”Ÿæˆ
      const createRecordHtml = (entry) => {
          const isLargeScreen = window.matchMedia('(min-width: 984px)').matches;
          const formattedDate = new Date(entry.timestamp).toLocaleString('ja-JP', {
              year: 'numeric', month: '2-digit', day: '2-digit',
              hour: '2-digit', minute: '2-digit'
          }).replace(/\//g, '-');

          if (isLargeScreen) {
              const tr = document.createElement('tr');
              const fields = ['date', 'deck', 'opponent', 'firstSecond', 'result', 'memo'];
              fields.forEach(field => {
                const td = document.createElement('td');
                td.textContent = (field === 'date') ? formattedDate : entry[field];
                td.dataset.label = (field === 'date') ? 'æ—¥æ™‚' : (field === 'deck' ? 'ãƒ‡ãƒƒã‚­' : (field === 'opponent' ? 'ç›¸æ‰‹' : (field === 'firstSecond' ? 'å…ˆå¾Œ' : (field === 'result' ? 'å‹æ•—' : 'ãƒ¡ãƒ¢'))));
                if (field === 'memo') {
                    makeEditableCell(td, entry, field, 'textarea');
                } else if (field !== 'date') {
                    makeEditableCell(td, entry, field, 'text');
                }
                tr.appendChild(td);
              });

              const delTd = document.createElement('td');
              const delBtn = document.createElement('button');
              delBtn.textContent = 'ğŸ—‘ï¸';
              Object.assign(delBtn.style, { cursor: 'pointer', fontSize: '16px', border: 'none', background: 'transparent' });
              delBtn.title = 'å‰Šé™¤';
              delBtn.setAttribute('aria-label', `${formattedDate}ã®è¨˜éŒ²ã‚’å‰Šé™¤`);
              delBtn.onclick = () => {
                const indexToRemove = allRecords.findIndex(rec => rec.timestamp === entry.timestamp);
                if (indexToRemove !== -1) {
                  allRecords.splice(indexToRemove, 1);
                  saveRecords();
                  applyFilters();
                }
              };
              delTd.appendChild(delBtn);
              tr.appendChild(delTd);
              return tr;
          } else {
              const cardDiv = document.createElement('div');
              cardDiv.classList.add('match-record-card');
              cardDiv.dataset.timestamp = entry.timestamp;

              cardDiv.innerHTML = `
                  <div class="card-item"><span class="card-label">æ—¥æ™‚:</span> <span class="card-value">${formattedDate}</span></div>
                  <div class="card-item"><span class="card-label">ãƒ‡ãƒƒã‚­:</span> <span class="card-value">${entry.deck}</span></div>
                  <div class="card-item"><span class="card-label">ç›¸æ‰‹:</span> <span class="card-value">${entry.opponent}</span></div>
                  <div class="card-item"><span class="card-label">å…ˆå¾Œ:</span> <span class="card-value">${entry.firstSecond}</span></div>
                  <div class="card-item"><span class="card-label">å‹æ•—:</span> <span class="card-value">${entry.result}</span></div>
                  <div class="card-item"><span class="card-label">ãƒ¡ãƒ¢:</span> <span class="card-value">${entry.memo}</span></div>
              `;

              const deleteButton = document.createElement('button');
              deleteButton.classList.add('delete-card-button');
              deleteButton.title = 'å‰Šé™¤';
              deleteButton.textContent = 'ğŸ—‘ï¸';
              deleteButton.setAttribute('aria-label', `${formattedDate}ã®è¨˜éŒ²ã‚’å‰Šé™¤`);
              cardDiv.appendChild(deleteButton);

              deleteButton.addEventListener('click', () => {
                  const indexToRemove = allRecords.findIndex(rec => rec.timestamp === cardDiv.dataset.timestamp);
                  if (indexToRemove !== -1) {
                      allRecords.splice(indexToRemove, 1);
                      saveRecords();
                      applyFilters();
                  }
              });
              return cardDiv;
          }
      };

      // æ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ 
      const addRecordEntry = (deck, opponent, firstSecond, result, memo) => {
        const newRecord = {
          timestamp: new Date().toISOString(),
          date: new Date().toLocaleString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }).replace(/\//g, '-'),
          deck, opponent, firstSecond, result, memo
        };
        allRecords.unshift(newRecord);
        saveRecords();
        currentDisplayCount = recordsPerPage;
        applyFilters();
      };

      // ãƒ¬ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ãƒãƒ³ãƒ‰ãƒ©
      const handleRecordSubmit = async (e) => {
        e.preventDefault();
        const deck = myDeckInput.value;
        const opponent = ToggleButtonGroup.getSelectedValue('opponent-class-selection');
        const firstSecond = ToggleButtonGroup.getSelectedValue('turn-order-selection');
        const result = ToggleButtonGroup.getSelectedValue('match-result-selection');
        const memo = recordMemoInput.value;

        if (!opponent || !firstSecond || !result) {
          await ModalManager.showAlert('ã™ã¹ã¦é¸æŠã—ã¦ãã ã•ã„');
          return;
        }

        addRecordEntry(deck, opponent, firstSecond, result, memo);
        Storage.set(LAST_DECK_KEY, deck);
        recordMemoInput.value = '';
        document.querySelectorAll('#opponent-class-selection button.active, #turn-order-selection button.active, #match-result-selection button.active').forEach(btn => {
          btn.classList.remove('active');
        });
      };

      // ãƒ¢ãƒã‚¤ãƒ«è¡¨ç¤ºã§ã•ã‚‰ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ãƒ­ãƒ¼ãƒ‰
      const loadMoreRecords = () => {
          const oldDisplayCount = currentDisplayCount;
          currentDisplayCount += recordsPerPage;
          const isLargeScreen = window.matchMedia('(min-width: 984px)').matches;

          if (!isLargeScreen) {
              const newRecordsToAppend = filteredRecordsCache.slice(oldDisplayCount, currentDisplayCount);
              newRecordsToAppend.forEach(entry => {
                  matchRecordCardsContainer.appendChild(createRecordHtml(entry));
              });
              loadMoreButton.style.display = (filteredRecordsCache.length > currentDisplayCount) ? 'block' : 'none';
          } else {
              applyFilters();
          }
      };

      const debouncedLoadRecords = debounce(loadRecords, 300);

      const init = () => {
        const lastDeck = Storage.get(LAST_DECK_KEY);
        if (lastDeck) myDeckInput.value = lastDeck;

        filterDeckNameInput.value = Storage.get(FILTER_DECK_KEY, '');
        ToggleButtonGroup.setActiveButton('filter-opponent-class-selection', Storage.get(FILTER_CLASS_KEY, ''));
        ToggleButtonGroup.setActiveButton('filter-turn-order-selection', Storage.get(FILTER_TURN_KEY, ''));

        loadRecords();

        addRecordForm.addEventListener('submit', handleRecordSubmit);
        filterDeckNameInput.addEventListener('input', () => {
            Storage.set(FILTER_DECK_KEY, filterDeckNameInput.value);
            debouncedLoadRecords();
        });
        document.addEventListener('filterChange', (e) => {
            if (e.detail.groupId === 'filter-opponent-class-selection') {
                Storage.set(FILTER_CLASS_KEY, e.detail.value);
                loadRecords();
            } else if (e.detail.groupId === 'filter-turn-order-selection') {
                Storage.set(FILTER_TURN_KEY, e.detail.value);
                loadRecords();
            }
        });
        clearRecordFiltersButton.addEventListener('click', () => {
            filterDeckNameInput.value = '';
            ToggleButtonGroup.setActiveButton('filter-opponent-class-selection', '');
            ToggleButtonGroup.setActiveButton('filter-turn-order-selection', '');
            Storage.remove(FILTER_DECK_KEY);
            Storage.remove(FILTER_CLASS_KEY);
            Storage.remove(FILTER_TURN_KEY);
            loadRecords();
        });

        if (recordFilterDetails) {
          const isFilterOpen = Storage.get(FILTER_OPEN_KEY, false);
          recordFilterDetails[isFilterOpen ? 'setAttribute' : 'removeAttribute']('open', '');
          recordFilterDetails.addEventListener('toggle', () => {
            Storage.set(FILTER_OPEN_KEY, recordFilterDetails.open);
          });
        }
        loadMoreButton.addEventListener('click', loadMoreRecords);
      };

      return { init, loadRecords, applyFilters };
    })();

    // Card List Management Module
    const CardListManager = (() => {
      const classFilterGroup = document.getElementById('class-filter-group');
      const currentClassDisplay = document.getElementById('current-class-display');
      const cardDataTableBody = document.querySelector('#card-data-table tbody');
      const addCardForm = document.getElementById('add-card-form');
      const newCardPpInput = document.getElementById('new-card-pp-input');
      const newCardNameInput = document.getElementById('new-card-name-input');
      const resetCardCountsButton = document.getElementById('reset-card-counts-button');
      const toggleCardDeleteModeButton = document.getElementById('toggle-card-delete-mode-button');
      const counterSection = document.getElementById('counter-section');

      let currentClass = '';
      let allCardData = {};

      const saveCards = (className) => {
        if (!className) return;
        Storage.set(CARD_CLASS_PREFIX + className, allCardData[className] || []);
      };

      const loadCards = (className) => {
        if (!className) return [];
        return Storage.get(CARD_CLASS_PREFIX + className, []);
      };

      const loadAllClassCards = () => {
        const classNames = ["ã‚¨ãƒ«ãƒ•", "ãƒ­ã‚¤ãƒ¤ãƒ«", "ã‚¦ã‚£ãƒƒãƒ", "ãƒ‰ãƒ©ã‚´ãƒ³", "ãƒŠã‚¤ãƒˆãƒ¡ã‚¢", "ãƒ“ã‚·ãƒ§ãƒƒãƒ—", "ãƒãƒ¡ã‚·ã‚¹"];
        classNames.forEach(name => {
            allCardData[name] = loadCards(name);
        });
        if (currentClass) renderCardList();
      };

      const sortCards = (cards) => cards.sort((a, b) => a.pp - b.pp);

      const renderCardList = () => {
        cardDataTableBody.innerHTML = '';
        if (!currentClass) {
          currentClassDisplay.textContent = '';
          return;
        }
        currentClassDisplay.textContent = `ã‚¯ãƒ©ã‚¹: ${currentClass}`;

        const cards = allCardData[currentClass] || [];
        sortCards(cards);

        cards.forEach((card, index) => {
          const tr = document.createElement('tr');

          const tdPP = document.createElement('td');
          tdPP.textContent = card.pp;
          tdPP.style.cursor = 'pointer';
          tdPP.title = 'ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†';
          tdPP.addEventListener('click', () => {
            if (tdPP.querySelector('input')) return;
            const input = document.createElement('input');
            input.type = 'number';
            input.min = '0';
            input.value = card.pp;
            Object.assign(input.style, { fontSize: '14px' });
            input.setAttribute('aria-label', `ã‚«ãƒ¼ãƒ‰PPã‚’ç·¨é›†: ${card.name}`);
            tdPP.textContent = '';
            tdPP.appendChild(input);
            input.focus();
            const finishEdit = () => {
              let val = parseInt(input.value, 10);
              if (isNaN(val) || val < 0) val = 0;
              card.pp = val;
              renderCardList();
              saveCards(currentClass);
            };
            input.addEventListener('blur', finishEdit);
            input.addEventListener('keydown', (ev) => {
              if (ev.key === 'Enter') finishEdit();
              else if (ev.key === 'Escape') renderCardList();
            });
          });
          tr.appendChild(tdPP);

          const tdName = document.createElement('td');
          tdName.textContent = card.name;
          tdName.style.cursor = 'pointer';
          tdName.title = 'ã‚¯ãƒªãƒƒã‚¯ã§ç·¨é›†';
          tdName.addEventListener('click', () => {
            if (tdName.querySelector('input')) return;
            const input = document.createElement('input');
            input.type = 'text';
            input.value = card.name;
            Object.assign(input.style, { fontSize: '14px' });
            input.setAttribute('aria-label', `ã‚«ãƒ¼ãƒ‰åã‚’ç·¨é›†: ${card.name}`);
            tdName.textContent = '';
            tdName.appendChild(input);
            input.focus();
            const finishEdit = () => {
              const val = input.value.trim();
              card.name = val || '(ç„¡åã‚«ãƒ¼ãƒ‰)';
              renderCardList();
              saveCards(currentClass);
            };
            input.addEventListener('blur', finishEdit);
            input.addEventListener('keydown', (ev) => {
              if (ev.key === 'Enter') finishEdit();
              else if (ev.key === 'Escape') renderCardList();
            });
          });
          tr.appendChild(tdName);

          const tdCount = document.createElement('td');
          const btnMinus = document.createElement('button');
          btnMinus.textContent = 'âˆ’';
          btnMinus.setAttribute('aria-label', `${card.name}ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’æ¸›ã‚‰ã™`);
          btnMinus.addEventListener('click', (e) => {
            e.preventDefault();
            if (card.count > 0) {
              card.count--;
              renderCardList();
              saveCards(currentClass);
            }
          });
          const spanCount = document.createElement('span');
          spanCount.textContent = card.count;
          spanCount.setAttribute('aria-live', 'polite');
          const btnPlus = document.createElement('button');
          btnPlus.textContent = '+';
          btnPlus.setAttribute('aria-label', `${card.name}ã®ã‚«ã‚¦ãƒ³ãƒˆã‚’å¢—ã‚„ã™`);
          btnPlus.addEventListener('click', (e) => {
            e.preventDefault();
            card.count++;
            renderCardList();
            saveCards(currentClass);
          });
          tdCount.appendChild(btnMinus);
          tdCount.appendChild(spanCount);
          tdCount.appendChild(btnPlus);
          tr.appendChild(tdCount);

          const tdDel = document.createElement('td');
          const btnDel = document.createElement('button');
          btnDel.classList.add('card-delete-button');
          btnDel.textContent = 'ğŸ—‘ï¸';
          Object.assign(btnDel.style, { cursor: 'pointer', fontSize: '16px', border: 'none', background: 'transparent' });
          btnDel.title = 'å‰Šé™¤';
          btnDel.setAttribute('aria-label', `${card.name}ã‚’ãƒªã‚¹ãƒˆã‹ã‚‰å‰Šé™¤`);
          btnDel.addEventListener('click', (e) => {
            e.preventDefault();
            allCardData[currentClass].splice(index, 1);
            renderCardList();
            saveCards(currentClass);
          });
          tdDel.appendChild(btnDel);
          tr.appendChild(tdDel);

          cardDataTableBody.appendChild(tr);
        });
      };

      const handleClassSelection = (e) => {
        if (e.target.tagName !== 'BUTTON') return;
        classFilterGroup.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
        e.target.classList.add('active');
        currentClass = e.target.dataset.class;
        allCardData[currentClass] = loadCards(currentClass);
        renderCardList();
      };

      const handleCardAdd = async (e) => {
        e.preventDefault();
        if (!currentClass) {
          await ModalManager.showAlert('ã¾ãšå·¦ä¸Šã®ã‚¯ãƒ©ã‚¹ã‚’é¸æŠã—ã¦ãã ã•ã„');
          return;
        }
        let ppVal = parseInt(newCardPpInput.value, 10);
        if (isNaN(ppVal) || ppVal < 0) {
          await ModalManager.showAlert('PPã¯0ä»¥ä¸Šã®æ•´æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          newCardPpInput.focus();
          return;
        }
        let nameVal = newCardNameInput.value.trim();
        if (!nameVal) {
          await ModalManager.showAlert('ã‚«ãƒ¼ãƒ‰åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          newCardNameInput.focus();
          return;
        }
        if (!allCardData[currentClass]) allCardData[currentClass] = [];
        allCardData[currentClass].push({pp: ppVal, name: nameVal, count: 0});
        allCardData[currentClass] = sortCards(allCardData[currentClass]);
        saveCards(currentClass);
        renderCardList();
        addCardForm.reset();
        newCardPpInput.focus();
      };

      const resetCounts = () => {
        allCardData[currentClass].forEach(card => {
          card.count = 0;
        });
        saveCards(currentClass);
        renderCardList();
      };

      const toggleDeleteMode = () => {
        const isActive = counterSection.classList.toggle('delete-mode');
        toggleCardDeleteModeButton.textContent = isActive ? 'å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ ON' : 'å‰Šé™¤ãƒ¢ãƒ¼ãƒ‰ OFF';
        toggleCardDeleteModeButton.setAttribute('aria-pressed', isActive);
      };

      const init = () => {
        classFilterGroup.addEventListener('click', handleClassSelection);
        addCardForm.addEventListener('submit', handleCardAdd);
        resetCardCountsButton.addEventListener('click', resetCounts);
        toggleCardDeleteModeButton.addEventListener('click', toggleDeleteMode);
        toggleCardDeleteModeButton.setAttribute('aria-pressed', 'false');

        loadAllClassCards();

        const firstBtn = classFilterGroup.querySelector('button');
        if (firstBtn && !classFilterGroup.querySelector('.active')) {
          firstBtn.click();
        }
      };

      return { init, getAllCardData: () => allCardData, CLASS_PREFIX: CARD_CLASS_PREFIX, renderCardList, loadAllClassCards };
    })();

    // Data Import/Export Management Module
    const DataManager = (() => {
      const exportAsJson = (filename, data) => {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      const readJsonFile = async (inputEl, callback) => {
        const file = inputEl.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = async () => {
          try {
            const data = JSON.parse(reader.result);
            await callback(data);
          } catch (e) {
            await ModalManager.showAlert('èª­ã¿è¾¼ã¿å¤±æ•—ï¼šJSONã®å½¢å¼ãŒä¸æ­£ãªãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            console.error('JSON parse error:', e);
          }
        };
        reader.readAsText(file);
      };

      const init = () => {
        document.getElementById('export-records-button').addEventListener('click', () => {
          const records = Storage.get(RECORDS_KEY, []);
          exportAsJson(`svwb_records_${new Date().toISOString().slice(0,10)}.json`, records);
        });

        document.getElementById('export-cards-button').addEventListener('click', () => {
          const cards = CardListManager.getAllCardData();
          exportAsJson(`svwb_cards_${new Date().toISOString().slice(0,10)}.json`, cards);
        });

        document.getElementById('export-all-data-button').addEventListener('click', () => {
          const records = Storage.get(RECORDS_KEY, []);
          const cards = CardListManager.getAllCardData();
          exportAsJson(`svwb_all_${new Date().toISOString().slice(0,10)}.json`, { records, cards });
        });

        document.getElementById('import-records-file-input').addEventListener('change', (e) => {
          readJsonFile(e.target, async (data) => {
            if (!Array.isArray(data)) {
                await ModalManager.showAlert('æˆ¦ç¸¾ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã§ã™: ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒé…åˆ—å½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }
            Storage.set(RECORDS_KEY, data);
            RecordManager.loadRecords();
            await ModalManager.showAlert('æˆ¦ç¸¾ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚');
            e.target.value = '';
          });
        });

        document.getElementById('import-cards-file-input').addEventListener('change', (e) => {
          readJsonFile(e.target, async (data) => {
            if (typeof data !== 'object' || data === null) {
              await ModalManager.showAlert('ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã§ã™: ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
              return;
            }
            let importedCount = 0;
            for (const className in data) {
              if (Array.isArray(data[className])) {
                Storage.set(CARD_CLASS_PREFIX + className, data[className]);
                importedCount++;
              }
            }
            CardListManager.loadAllClassCards();
            if (importedCount > 0) {
              await ModalManager.showAlert('ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚');
            } else {
              await ModalManager.showAlert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹æœ‰åŠ¹ãªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            }
            e.target.value = '';
          });
        });

        document.getElementById('import-all-data-file-input').addEventListener('change', (e) => {
          readJsonFile(e.target, async (data) => {
            if (!data || typeof data !== 'object') {
                await ModalManager.showAlert('å…¨ä½“ãƒ‡ãƒ¼ã‚¿ãŒä¸æ­£ã§ã™: ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚');
                return;
            }
            if (Array.isArray(data.records)) {
              Storage.set(RECORDS_KEY, data.records);
            } else {
                console.warn('å…¨ä½“ãƒ‡ãƒ¼ã‚¿ã«æœ‰åŠ¹ãªæˆ¦ç¸¾ãƒ‡ãƒ¼ã‚¿ï¼ˆrecordsï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
            }

            if (typeof data.cards === 'object' && data.cards !== null) {
              let importedCardClassesCount = 0;
              for (const className in data.cards) {
                if (Array.isArray(data.cards[className])) {
                  Storage.set(CARD_CLASS_PREFIX + className, data[className]);
                  importedCardClassesCount++;
                }
              }
              if (importedCardClassesCount === 0) {
                console.warn('å…¨ä½“ãƒ‡ãƒ¼ã‚¿ã«æœ‰åŠ¹ãªã‚«ãƒ¼ãƒ‰ã‚¯ãƒ©ã‚¹ï¼ˆcardsï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
              }
            } else {
                console.warn('å…¨ä½“ãƒ‡ãƒ¼ã‚¿ã«æœ‰åŠ¹ãªã‚«ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ï¼ˆcardsï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚');
            }

            RecordManager.loadRecords();
            CardListManager.loadAllClassCards();
            await ModalManager.showAlert('å…¨ä½“ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸã€‚');
            e.target.value = '';
          });
        });

        document.getElementById('clear-records-button').addEventListener('click', async () => {
          const confirmed = await ModalManager.showConfirm('æœ¬å½“ã«æˆ¦ç¸¾ã‚’ã™ã¹ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');
          if (confirmed) {
            Storage.remove(RECORDS_KEY);
            RecordManager.loadRecords();
            await ModalManager.showAlert('æˆ¦ç¸¾ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
          }
        });
      };

      return { init };
    })();

    // Tooltip Script (New Module for click behavior)
    const TooltipManager = (() => {
        let infoButton;
        let infoTooltip;

        const init = () => {
            infoButton = document.getElementById('info-button-trigger');
            infoTooltip = document.getElementById('info-tooltip-content');

            if (infoButton && infoTooltip) {
                infoButton.addEventListener('click', (event) => {
                    event.stopPropagation();
                    infoTooltip.classList.toggle('show');
                });

                document.addEventListener('click', (event) => {
                    if (!infoButton.contains(event.target) && !infoTooltip.contains(event.target)) {
                        infoTooltip.classList.remove('show');
                    }
                });
            }
        };

        return { init };
    })();

    // Initialize all modules when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      TabManager.init();
      ToggleButtonGroup.init();
      RecordManager.init();
      CardListManager.init();
      DataManager.init();
      TooltipManager.init();
      ModalManager.init(); // ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’åˆæœŸåŒ–
    });
  </script>
</body>
</html>
